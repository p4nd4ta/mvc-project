@model Drinks_Self_Learn.ViewModels.DrinkDetailsViewModel


<div class="card">
    <div class="card-header">
        <h2>@Model.Drink.Name</h2>
    </div>
    <div>

        <div class="row carousel-holder marginTop1">
            <div class="col-md-12">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        @for (int i = 1; i < Model.ImgUrlsArr.Length; i++)
                        {
                            <li data-target="#carouselExampleIndicators" data-slide-to="@i"></li>
                        }
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img class="slide-image" src="@Model.ImgUrlsArr[0]" alt="">
                        </div>
                        @for (int i = 1; i < Model.ImgUrlsArr.Length; i++)
                        {
                            <div class="carousel-item">
                                <img class="slide-image" src="@Model.ImgUrlsArr[i]" alt="">
                            </div>
                        }
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>

        <p class="mt-2">@Model.Drink.LongDescription</p>
    </div>
    <div class="card-footer">
        @if (Model.Drink.InStock)
        {
            <strong class="text-success text-left">In stock</strong>
            <h4 class="text-left mt-1">@Model.Drink.Price.ToString("c")</h4>
            <div class="addToCart text-right">
                <p class="btn">
                    <a class="btn btn-success" id="cartButton" asp-controller="ShoppingCart" asp-action="AddToShoppingCart" asp-route-drinkId="@Model.Drink.DrinkId">
                        Add to cart &nbsp;<i class="fas fa-cart-plus"></i>
                    </a>
                </p>
            </div>
        }
        else
        {
            <strong class="text-danger text-left">Out of stock</strong>
            <h4 class="text-left mt-1">@Model.Drink.Price.ToString("c")</h4>
            <div class="addToCart text-right">
                <p class="btn">
                    <a class="btn btn-success" id="cartButton" asp-controller="ShoppingCart" asp-action="AddToShoppingCart" asp-route-drinkId="@Model.Drink.DrinkId">
                        Preorder &nbsp;<i class="fas fa-truck-loading"></i>
                    </a>
                </p>
            </div>
        }
    </div>
</div>

@if (this.User.Identity.IsAuthenticated)
{
    <div>
        <form asp-action="New" asp-controller="Comments" method="post" class="mt-2" id="form-for-newComment">
            @Html.HiddenFor(m => m.Drink.DrinkId)
            <textarea id="NewCommentText" name="NewCommentText" class="form-control" maxlength="200"></textarea>
            <span class="float-right"><i id="char-count">0</i><strong>/200</strong></span>
            <a class="btn btn-primary mt-1 mb-1" onclick="CheckValidationComment()"><i class="fas fa-comment"></i> Comment</a>
            <span class="text-danger field-validation-valid" id="comment-validation"></span>
        </form>
    </div>
}
else
{
    <div class="card">
        <div class="card-header"><h5>UnAuthenticated!</h5></div>
        <div class="card-body"><h6 class="text-danger">Login in order to post comments</h6></div>
    </div>
}
@if (this.User.IsInRole("Administrator"))
{
    <div>
        @foreach (Comments comm in Model.Comments)
        {
            if (comm.Approved == false)
            {
                <div class="card mt-1 border-danger">
                    <div class="card-header">
                        <strong class="float-left">UserName: @comm.UserName</strong>
                        <i class="float-right">Posted at: @comm.CommentDate</i>
                    </div>
                    <div class="card-body"><p>@comm.CommentText</p></div>
                    <div class="card-footer">
                        @if (comm.Approved == true)
                        {
                            <a asp-action="ChangeStatusInt" asp-controller="Comments" asp-route-id="@comm.Id" class="btn btn-danger"><i class="fas fa-times"></i> Change Status</a>
                        }
                        else
                        {
                            <a asp-action="ChangeStatusInt" asp-controller="Comments" asp-route-id="@comm.Id" class="btn btn-success"><i class="fas fa-check"></i> Change Status</a>
                        }
                        <a asp-action="Edit" asp-controller="Comments" asp-route-id="@comm.Id" class="btn btn-warning"><i class="far fa-edit"></i> Edit</a>
                        <form asp-action="DeleteInt" asp-controller="Comments" asp-route-id="@comm.Id" method="post" class="d-inline-flex">
                            <span id="confirmDeleteSpan_@comm.Id" style="display:none">
                                <span>Are you sure you want to delete?</span>
                                <button type="submit" class="btn btn-danger">Yes</button>
                                <a class="btn btn-success" onclick="confirmDelete('@comm.Id', false)">No</a>
                            </span>

                            <span id="deleteSpan_@comm.Id">
                                <a class="btn btn-danger" onclick="confirmDelete('@comm.Id', true)"><i class="fas fa-trash"></i> Delete</a>
                            </span>
                        </form>
                    </div>
                </div>
            }
                else
            {
                <div class="card mt-1 border-success">
                    <div class="card-header">
                        <strong class="float-left">UserName: @comm.UserName</strong>
                        <i class="float-right">Posted at: @comm.CommentDate</i>
                    </div>
                    <div class="card-body"><p>@comm.CommentText</p></div>
                    <div class="card-footer">
                        @if (comm.Approved == true)
                        {
                            <a asp-action="ChangeStatusInt" asp-controller="Comments" asp-route-id="@comm.Id" class="btn btn-danger"><i class="fas fa-times"></i> Change Status</a>
                        }
                        else
                        {
                            <a asp-action="ChangeStatusInt" asp-controller="Comments" asp-route-id="@comm.Id" class="btn btn-success"><i class="fas fa-check"></i> Change Status</a>
                        }
                        <a asp-action="Edit" asp-controller="Comments" asp-route-id="@comm.Id" class="btn btn-warning"><i class="far fa-edit"></i> Edit</a>
                        <form asp-action="DeleteInt" asp-controller="Comments" asp-route-id="@comm.Id" method="post" class="d-inline-flex">
                            <span id="confirmDeleteSpan_@comm.Id" style="display:none">
                                <span>Are you sure you want to delete?</span>
                                <button type="submit" class="btn btn-danger">Yes</button>
                                <a class="btn btn-success" onclick="confirmDelete('@comm.Id', false)">No</a>
                            </span>

                            <span id="deleteSpan_@comm.Id">
                                <a class="btn btn-danger" onclick="confirmDelete('@comm.Id', true)"><i class="fas fa-trash"></i> Delete</a>
                            </span>
                        </form>
                    </div>
                </div>
            }
        }

    </div>

}
@if(!this.User.IsInRole("Administrator"))
{
    <div>
        @foreach (Comments comm in Model.Comments)
        {
            if (comm.Approved == true)
            {
                <div class="card mt-1">
                    <div class="card-header">
                        <strong class="float-left">UserName: @comm.UserName</strong>
                        <i class="float-right">Posted at: @comm.CommentDate</i>
                    </div>
                    <div class="card-body">
                        <p>@comm.CommentText</p>
                    </div>
                </div>
            }
        }

    </div>
}


@section Scripts{
    <script src="~/lib/js/DeleteScript.js"></script>
    <script src="~/lib/js/CommentScript.js"></script>
    <script src="~/lib/js/CommentCounter.js"></script>
}